<% layout('layouts/boilerplate') %>
<%- include('partials/navbar') %>


<section id="page">
    <section class="container">
        <div id="hero">
            <div id="title-header" class="d-lg-flex bd-highlight">
                <h1><%= showData.name %> </h1>
                <meter class="average-rating ms-auto" min="0" max="5" value="4.3" title="4.3 out of 5 stars">4.3 out of 5</meter>
            </div>
            <div class="d-flex flex-row bd-highlight mb-3">
                <h4><%= showData.premiered? showData.premiered.slice(0, 4) + ' ': '' %><%= showData.ended? `- ${showData.ended.slice(0, 4)}`: '' %></h4>
                <h4><%= showData.averageRuntime? `${showData.averageRuntime}m`: '' %></h4>
            </div>
            <div id="photo-trailer" class="row">
                <img class="hero-image col-lg-3 col-md-12" src="<%= showData.image? showData.image.original: 'https://t3.ftcdn.net/jpg/03/34/83/22/360_F_334832255_IMxvzYRygjd20VlSaIAFZrQWjozQH6BQ.jpg'  %>" alt="dsa" sizes="" srcset="">
                <iframe class="col-lg-8 col-md-12" src="https://www.youtube.com/embed/<%= //videoId %>" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
                <div  class="col-lg-1 col-md-12"></div>
                <!-- videoId -->
            </div>
            <% if (showData.genres) { %>
                <div class="mt-3">
                    <% for( let genre of showData.genres ) { %>
                        <button class="genres-buttons me-1"><%= genre %></button>
                    <% } %>
                </div>
            <% } %>
            <div>
                <%function cleanedSummary (summary) {   %>
                <%    let cleanSummary = [];%>
                <%    for(let word of summary.split(' ')) {%>
                <%        let iStart = word.indexOf('<');%>
                <%        let iEnd = word.indexOf('>');%>
                <%        if (iStart !== -1) {%>
                <%            // we split the letters into an array, because 'splice' doesn't work on string.%>
                <%            let arrayOfLetters = word.split('');%>
                <%            word = arrayOfLetters;%>
                <%            // remember that splice returns the removed items and that it mutates the array. We will utilize this by only calling it and then using the mutated array.%>
                <%            word.splice(iStart, iEnd +1);%>
                <%            word = word.join('');%>
                <%        }%>
                <%        cleanSummary.push(word);%>
                <%    }%>
                <%    return cleanSummary.join(' ');%>
                <%}%>
                <h5 class="col-lg-7 text-white mt-3 pb-3 fw-light"><%= cleanedSummary(showData.summary) %></h5>
            </div>
            <% if (crewData.length > 0) { %>
                <div class="crew col-lg-7 text-white">
                    <h5 class="fw-bold">
                        <span id="crew">Crew</span>
                        <% for( let i = 0; i < (crewData.length < 4 ? crewData.length: 4); i++ ) { %>
                            <span class="crew-member fw-light">
                                <% if (i != 0) { %>
                                    <span class="dot">â€¢</span>
                                <% } %>
                                <a target="_blank" title="<%= crewData[i].type %>" href="<%= crewData[i].person.url %>"><%= crewData[i].person.name %></a>
                            </span>
                        <% } %> 
                    </h5>
                </div>
            <% } %>
        </div>
    </section>
</section>

<section id="page2">
    <section class="container">
            <section class="row">
                <div class="col-lg-8">
                    <div id="cast">
                        <h3>Cast <svg width="81px" height="81px" viewBox="0 0 24.00 24.00" fill="none" xmlns="http://www.w3.org/2000/svg" transform="matrix(1, 0, 0, 1, 0, 0)rotate(0)"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" stroke="#ff0000" stroke-width="2.832"></g><g id="SVGRepo_iconCarrier"> <g id="Arrow / Caret_Right_SM"> <path id="Vector" d="M11 9L14 12L11 15" stroke="#ffea00" stroke-width="1.6320000000000001" stroke-linecap="round" stroke-linejoin="round"></path> </g> </g></svg></h3>
                        <div class="row">
                            <% for( i = 0; i < (castData.length < 5? castData.length : 5); i++) { %>
                                <% if (castData[i].person) { %>
                                    <div class="cast-person card col-4 mb-4">
                                        <div class="row g-0">
                                            <div class="col-md-4">
                                              <img src="<%= castData[i].person.image? castData[i].person.image.medium : 'https://imagedelivery.net/5MYSbk45M80qAwecrlKzdQ/49d53747-1189-4811-d83b-4fadcb1dad00/thumbnail?v=2023082806' %>" class="img-fluid" alt="...">
                                            </div>
                                            <div class="col-md-8">
                                              <div class="card-body">
                                                <p class="card-text fw-bold"><%= castData[i].person.name %></p>
                                                <p class="card-text"><%= castData[i].character.name %></p>
                                              </div>
                                            </div>
                                          </div>                        
                                    </div>
                                <% } %>
                            <% } %>
                        </div>
                    </div>
                    <section id="image-gallery">
                        <h3>Image Gallery <svg width="81px" height="81px" viewBox="0 0 24.00 24.00" fill="none" xmlns="http://www.w3.org/2000/svg" transform="matrix(1, 0, 0, 1, 0, 0)rotate(0)"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" stroke="#ff0000" stroke-width="2.832"></g><g id="SVGRepo_iconCarrier"> <g id="Arrow / Caret_Right_SM"> <path id="Vector" d="M11 9L14 12L11 15" stroke="#ffea00" stroke-width="1.6320000000000001" stroke-linecap="round" stroke-linejoin="round"></path> </g> </g></svg></h3>
                        <div id="carousel" class="carousel slide " data-bs-ride="carousel">
                            <div class="carousel-indicators"> 
                              <button type="button" data-bs-target="#carousel" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                              <% for( let i = 1; i < (imgData.length < 5? imgData.length : 5); i++ ) { %>
                                <button type="button" data-bs-target="#carousel" data-bs-slide-to="<%= i %>" aria-label="Slide <%= i+1 %>"></button>
                              <% } %>
                            </div>
                            <div class="carousel-inner">
                              <div class="carousel-item active">
                                <img src="https://static.tvmaze.com/uploads/images/original_untouched/223/557688.jpg" class="d-block w-100" alt="...">
                              </div>
                              <% for( let i = 1; i < (imgData.length < 5? imgData.length : 5); i++ ) { %>
                                <div class="carousel-item">
                                    <img src="<%= imgData[i].resolutions.original.url? imgData[i].resolutions.original.url: ' ' %>" class="d-block w-100" alt="...">
                                  </div>
                              <% } %>
                            </div>
                            <button class="carousel-control-prev" type="button" data-bs-target="#carousel" data-bs-slide="prev">
                              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                              <span class="visually-hidden">Previous</span>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#carousel" data-bs-slide="next">
                              <span class="carousel-control-next-icon" aria-hidden="true"></span>
                              <span class="visually-hidden">Next</span>
                            </button>
                          </div>
                    </section>
                </div>
                <div class="col-lg-4">
                    <h3>Episodes <svg width="81px" height="81px" viewBox="0 0 24.00 24.00" fill="none" xmlns="http://www.w3.org/2000/svg" transform="matrix(1, 0, 0, 1, 0, 0)rotate(0)"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" stroke="#ff0000" stroke-width="2.832"></g><g id="SVGRepo_iconCarrier"> <g id="Arrow / Caret_Right_SM"> <path id="Vector" d="M11 9L14 12L11 15" stroke="#ffea00" stroke-width="1.6320000000000001" stroke-linecap="round" stroke-linejoin="round"></path> </g> </g></svg></h3>
                    <% if (seasonsData.length > 0) { %>
                        <div class="episodes-list">
                            <div class="accordion" id="accordionPanelsStayOpenExample">
                                <% for( let i = 0; i < seasonsData.length; i++ ) { %>
                                    <% if (i == 0) { %>
                                        <div class="accordion-item">
                                            <h2 class="accordion-header">
                                              <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseOne" aria-expanded="true" aria-controls="panelsStayOpen-collapseOne">
                                               Season <%= seasonsData[i].number %>
                                              </button>
                                            </h2>
                                            <div id="panelsStayOpen-collapseOne" class="accordion-collapse collapse show">
                                              <div class="accordion-body">
                                                <% let filteredEpisodes = episodesData.filter(episode => episode.season == seasonsData[i].number) %>
                                                <% for( let episode of filteredEpisodes ) { %>
                                                    <div class="row text-center mb-3">
                                                        <div class="col-lg-2"><%= episode.number %></div>
                                                        <div class="col-lg-5"><%= episode.name %></div>
                                                        <div class="col-lg-5 episode-airdate"><%= episode.airdate %></div>
                                                    </div>
                                                <% } %>
                                              </div>
                                            </div>
                                          </div>
                                    <% } %>
                                      <% if (i > 0) { %>
                                        <div class="accordion-item">
                                            <h2 class="accordion-header">
                                              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#item<%= i %>" aria-expanded="false" aria-controls="item<%= i %>">
                                                Season <%= seasonsData[i].number %>
                                              </button>
                                            </h2>
                                            <div id="item<%= i %>" class="accordion-collapse collapse">
                                              <div class="accordion-body">
                                                <% let filteredEpisodes = episodesData.filter(episode => episode.season == seasonsData[i].number) %>
                                                <% for( let episode of filteredEpisodes ) { %>
                                                    <div class="row text-center mb-3">
                                                        <div class="col-lg-2"><%= episode.number %></div>
                                                        <div class="col-lg-6"><%= episode.name %></div>
                                                        <div class="col-lg-4 episode-airdate"><%= episode.airdate %></div>
                                                    </div>
                                                <% } %>
                                              </div>
                                            </div>
                                          </div>
                                      <% } %>
                                <% } %>    
                            </div>
                        </div>
                    <% } %>
                </div>
            </section>
    </section>
</section>

<%- include('partials/footer') %>